name: Deploy to DEV (Main Branch)

on:
  push:
    branches:
      - main

jobs:
  deploy-dev:
    uses: ./.github/workflows/reusable-deploy.yml
    with:
      environment: 'DEV'
      schema: 'DEV'
      change_history_table: 'DELL.DEV.CHANGE_HISTORY'
      migrations_folder: 'migrations'
      use_key_pair_auth: true        # âœ… switch to key-pair auth
    secrets:
      SF_ACCOUNT:        ${{ secrets.SF_ACCOUNT }}         # e.g., yb12345.ap-south-1.aws
      SF_USERNAME:       ${{ secrets.SF_USERNAME }}        # e.g., GITHUB_CI_USER
      SF_ROLE:           ${{ secrets.SF_ROLE }}            # e.g., GITHUB_CI_ROLE
      SF_WAREHOUSE:      ${{ secrets.SF_WAREHOUSE }}       # e.g., COMPUTE_WH
      SF_DATABASE:       ${{ secrets.SF_DATABASE }}        # e.g., DELL
      # ðŸ”‘ New: base64-encoded private key
      SF_PRIVATE_KEY_B64: ${{ secrets.SF_PRIVATE_KEY_B64 }}  # base64 of rsa_key.p8
